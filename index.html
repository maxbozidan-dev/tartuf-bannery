<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bannery Tartuf - Live</title>
    <link rel="stylesheet" href="style.css">
</head>

<body class="dashboard">
    <header>
        <h1>Banner Dashboard pro Tartuf</h1>
        <p>Seznam všech dostupných HTML5 bannerů pro Shoptet (1704×1032).</p>
    </header>

    <main class="banner-list">
        <section class="editor-cta-inline">
            <a class="open-editor-btn" href="banner-editor.html" target="_blank">Otevřít editor</a>
        </section>

        <section class="dashboard-layout single-main">
            <article class="banner-card banner-main">
                <div class="banner-head">
                    <h2>Hlavní banner</h2>
                    <button class="copy-embed-btn" data-src="hlavni-banner.html">Kopírovat kód</button>
                </div>
                <div class="iframe-container iframe-main" style="aspect-ratio: 1704/1032;">
                    <iframe data-banner="hlavni-banner.html" src="hlavni-banner.html" frameborder="0" width="100%" height="auto"></iframe>
                </div>
            </article>
        </section>

        <section class="dashboard-layout side-by-side">
            <article class="banner-card">
                <div class="banner-head">
                    <h2>Doplňkový banner č. 1</h2>
                    <button class="copy-embed-btn" data-src="doplnkovy-banner-1.html">Kopírovat kód</button>
                </div>
                <div class="iframe-container iframe-side" style="aspect-ratio: 1704/1032;">
                    <iframe data-banner="doplnkovy-banner-1.html" src="doplnkovy-banner-1.html" frameborder="0" width="100%" height="auto"></iframe>
                </div>
            </article>

            <article class="banner-card">
                <div class="banner-head">
                    <h2>Doplňkový banner č. 2</h2>
                    <button class="copy-embed-btn" data-src="doplnkovy-banner-2.html">Kopírovat kód</button>
                </div>
                <div class="iframe-container iframe-side" style="aspect-ratio: 1704/1032;">
                    <iframe data-banner="doplnkovy-banner-2.html" src="doplnkovy-banner-2.html" frameborder="0" width="100%" height="auto"></iframe>
                </div>
            </article>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Tartuf - Animované Bannery</p>
    </footer>

    <script>
        (function () {
            const base = 'https://maxbozidan-dev.github.io/tartuf-bannery/';

            const buildPublishedUrl = (src) => {
                const url = new URL(`${base}${src}`);
                const raw = localStorage.getItem(`tartuf-publish-data-${src}`);
                if (!raw) return url.toString();

                try {
                    const data = JSON.parse(raw);
                    if (data.title) url.searchParams.set('title', data.title);
                    if (data.subtitle) url.searchParams.set('subtitle', data.subtitle);
                    if (data.ctaText) url.searchParams.set('ctaText', data.ctaText);
                    if (data.ctaHref) url.searchParams.set('ctaHref', data.ctaHref);
                    if (data.bgUrl) url.searchParams.set('bg', data.bgUrl);
                    if (data.rev) url.searchParams.set('rev', data.rev);
                } catch {}

                return url.toString();
            };

            const buildCode = (src) =>
                `<iframe src="${buildPublishedUrl(src)}" width="100%" style="aspect-ratio: 1704/1032;" frameborder="0" scrolling="no"></iframe>`;

            function applyPublishedToDashboard() {
                document.querySelectorAll('iframe[data-banner]').forEach((iframe) => {
                    const src = iframe.getAttribute('data-banner');
                    const nextUrl = buildPublishedUrl(src);
                    if (iframe.src !== nextUrl) {
                        iframe.src = nextUrl;
                    }
                });
            }

            applyPublishedToDashboard();

            window.addEventListener('storage', (event) => {
                if (!event.key || !event.key.startsWith('tartuf-publish-data-')) return;
                applyPublishedToDashboard();
            });

            document.querySelectorAll('.copy-embed-btn').forEach((btn) => {
                const src = btn.getAttribute('data-src');
                btn.addEventListener('click', async () => {
                    const code = buildCode(src);
                    await navigator.clipboard.writeText(code);
                    const original = btn.textContent;
                    btn.textContent = 'Zkopírováno ✓';
                    setTimeout(() => (btn.textContent = original), 1400);
                });
            });
        })();
    </script>
</body>

</html>
